name: Nick
date: '2012-07-09 05:56:00'
url: ''
message: "Hey Pat,\n\nPerhaps I'm missing something but....\n\n\nstatic void sbd_request(struct request_queue *q) {\n\tstruct request *req;\n\n\treq = blk_fetch_request(q);\n\twhile (req != NULL) {\n\t\t/* Are you sure you want to continue in the following block */\n\t\tif (req == NULL || (req-&gt;cmd_type != REQ_TYPE_FS)) {\n\t\t\tprintk (KERN_NOTICE \"Skip non-CMD request\\n\");\n\t\t\t__blk_end_request_all(req, -EIO);\n\t\t\tcontinue; // this will skip an iteration and spin surely?\n\t\t}\n\t\tsbd_transfer(&amp;Device, blk_rq_pos(req), blk_rq_cur_sectors(req),\n\t\t\t\treq-&gt;buffer, rq_data_dir(req));\n\t\tif ( ! __blk_end_request_cur(req, 0) ) {\n\t\t\treq = blk_fetch_request(q);\n\t\t}\n\t}\n}\n\n\nWould wrapping it in an if/else not be better such as:\n\nstatic void sbd_request(struct request_queue *q) {\n\tstruct request *req;\n\n\treq = blk_fetch_request(q);\n\twhile (req != NULL) {\n\t\t/* Are you sure you want to continue in the following block */\n\t\tif (req == NULL || (req-&gt;cmd_type != REQ_TYPE_FS)) {\n\t\t\tprintk (KERN_NOTICE \"Skip non-CMD request\\n\");\n\t\t\t__blk_end_request_all(req, -EIO);\n\t\t} else {\n\t\t\tsbd_transfer(&amp;Device, blk_rq_pos(req), blk_rq_cur_sectors(req),\n\t\t\t\t\treq-&gt;buffer, rq_data_dir(req));\n\t\t}\n\t\tif ( ! __blk_end_request_cur(req, 0) ) {\n\t\t\treq = blk_fetch_request(q);\n\t\t}\n\t}\n}"
email: bced02d8679209b2f3e44f7c15c7b39d
