name: Pat Patterson
date: '2012-07-09 10:36:54'
url: ''
message: "Nick - I think you're right on the possibility of spinning, but you wouldn't want to do __blk_end_request_all() then __blk_end_request_cur(). Since I'm no longer working on this stuff and have no way of testing it, are you able to confirm that the following works?\n\n<pre>\nstatic void sbd_request(struct request_queue *q) {\n\tstruct request *req;\n\n\treq = blk_fetch_request(q);\n\twhile (req != NULL) {\n\t\t// blk_fs_request() was removed in 2.6.36 - many thanks to\n\t\t// Christian Paro for the heads up and fix...\n\t\t//if (!blk_fs_request(req)) {\n\t\tif (req == NULL || (req->cmd_type != REQ_TYPE_FS)) {\n\t\t\tprintk (KERN_NOTICE \"Skip non-CMD request\\n\");\n\t\t\t__blk_end_request_all(req, -EIO);\n\t\t\tbreak;\n\t\t}\n\t\tsbd_transfer(&Device, blk_rq_pos(req), blk_rq_cur_sectors(req),\n\t\t\t\treq->buffer, rq_data_dir(req));\n\t\tif ( ! __blk_end_request_cur(req, 0) ) {\n\t\t\treq = blk_fetch_request(q);\n\t\t}\n\t}\n}\n</pre>"
email: 5080aaff59eac4d87182616a8005ba8c
